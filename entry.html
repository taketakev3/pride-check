<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>PRIDE 参加者確認</title>

<style>
/* ▼ 背景画像 */
body {
  margin: 0;
  background-size: cover;
  background-position: top center;
  background-attachment: fixed;
  font-size: 20px;
  display: flex;
  justify-content: center;
  padding: 40px 0;
}

/* ▼ 白パネル */
.outer-panel {
  background: rgba(255, 255, 255, 0.92);
  width: 60rem;
  max-width: 95%;
  padding: 30px 40px;
  border-radius: 15px;
  box-shadow: 0 0 20px rgba(0,0,0,0.25);
  box-sizing: border-box;
}

h2 { text-align: center; margin-top: 0; }

/* ▼ 3ボタン */
.button-row {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
  justify-content: center;
}
.button-row button {
  padding: 12px 20px;
  font-size: 20px;
  border: 2px solid #888;
  background: #fff;
  cursor: pointer;
  border-radius: 6px;
}
.button-row button.selected {
  background: #4da3ff;
  color: white;
  border-color: #1d6fd6;
  font-weight: bold;
}

/* ▼ 入力パネル */
.input-panel {
  display: none;
  width: 100%;
  padding: 20px;
  border: 2px solid #aaa;
  background: #ffffff;
  border-radius: 10px;
  margin-bottom: 20px;
  box-sizing: border-box;
}

.panel-title {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 15px;
  text-align: center;
}

label { display: block; margin-top: 12px; font-size: 18px; }
input {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 6px;
  border: 1px solid #aaa;
  box-sizing: border-box;
}

button { font-size: 18px; padding: 10px 16px; margin-top: 15px; }

.error { color: red; margin-top: 15px; font-size: 18px; }
.ok { color: green; margin-top: 15px; font-size: 18px; }

/* ▼ 注意事項 */
.notice {
  margin-top: 20px;
  font-size: 18px;
  font-weight: bold;
  color: #444;
  line-height: 1.6;
}
.notice .warning { color: red; }

/* ▼ スマホ対応 */
@media (max-width: 600px) {
  .button-row { flex-wrap: wrap; gap: 10px; }
  .button-row button { flex: 1 1 40%; min-width: 120px; font-size: 18px; }
  .outer-panel { padding: 20px; }
}
</style>
</head>

<body>

<div class="outer-panel">

  <h2>PRIDE 参加者確認</h2>

  <!-- 3ボタン -->
  <div class="button-row">
    <button id="btn1" onclick="showPanel(1)">SR</button>
    <button id="btn2" onclick="showPanel(2)">マークスマン</button>
    <button id="btn3" onclick="showPanel(3)">レディース</button>
  </div>

  <!-- SR -->
  <div id="panel1" class="input-panel">
    <div class="panel-title">SR部門</div>
    <label>ゲームの名前：</label>
    <input type="text" id="game1">
    <label>パラレルの名前：</label>
    <input type="text" id="parallel1">
    <button onclick="checkEntry(1)">判定</button>
    <div id="msg1"></div>
  </div>

  <!-- Marksman -->
  <div id="panel2" class="input-panel">
    <div class="panel-title">マークスマン部門</div>
    <label>ゲームの名前：</label>
    <input type="text" id="game2">
    <label>パラレルの名前：</label>
    <input type="text" id="parallel2">
    <button onclick="checkEntry(2)">判定</button>
    <div id="msg2"></div>
  </div>

  <!-- Ladies -->
  <div id="panel3" class="input-panel">
    <div class="panel-title">レディース部門</div>
    <label>ゲームの名前：</label>
    <input type="text" id="game3">
    <label>パラレルの名前：</label>
    <input type="text" id="parallel3">
    <button onclick="checkEntry(3)">判定</button>
    <div id="msg3"></div>
  </div>

  <!-- 注意事項 -->
  <div class="notice">
    ・ゲーム名とパラレル名は正確に入力してください。<br>
    ・抽選後に名前を変更された場合は、変更前の名前を入力してください。<br>
    ・お困りごとがございましたら隊長までご連絡ください。
      <a href="https://www.tiktok.com/@captain122483" target="_blank">（ヘルパー隊長）</a><br>
    <span class="warning">※いたずらの場合、今後の参加資格をはく奪される可能性があります。</span>
  </div>

  <div style="text-align:center; margin-top:25px;">
    <a href="index.html">
      <button style="font-size:20px; padding:12px 25px;">← メインページへ戻る</button>
    </a>
  </div>

</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, getDocs } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, signInAnonymously } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // ★ あなたの Firebase 設定
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ★ 匿名ログイン
  const auth = getAuth();
  signInAnonymously(auth);

  // ▼ パネル切り替え
  function showPanel(num) {
    document.querySelectorAll('.input-panel').forEach(p => p.style.display = 'none');
    document.getElementById(`panel${num}`).style.display = 'block';

    document.querySelectorAll('.button-row button').forEach(btn => btn.classList.remove('selected'));
    document.getElementById(`btn${num}`).classList.add('selected');

    // 入力欄クリア
    for (let i = 1; i <= 3; i++) {
      document.getElementById(`game${i}`).value = "";
      document.getElementById(`parallel${i}`).value = "";
      document.getElementById(`msg${i}`).textContent = "";
    }

    // 背景切替
    if (num === 1) document.body.style.backgroundImage = "url('bg_sr.jpg')";
    else if (num === 2) document.body.style.backgroundImage = "url('bg_marksman.jpg')";
    else document.body.style.backgroundImage = "url('IMG_9924.JPG')";
  }

  // 初期背景
  document.body.style.backgroundImage = "url('IMG_9922.JPG')";

  // ▼ Firestore 判定
  async function checkEntry(num) {
    const game = document.getElementById(`game${num}`).value.trim();
    const parallel = document.getElementById(`parallel${num}`).value.trim();
    const msg = document.getElementById(`msg${num}`);

    msg.textContent = "";
    msg.className = "";

    const colName =
      num === 1 ? "entries_SR" :
      num === 2 ? "entries_Marksman" :
                  "entries_Ladies";

    const snap = await getDocs(collection(db, colName));

    let found = false;
    snap.forEach(doc => {
      const d = doc.data();
      if (d.name1 === game && d.name2 === parallel) found = true;
    });

    if (found) {
      msg.textContent = "登録済みの組み合わせです";
      msg.className = "ok";
    } else {
      msg.textContent = "エントリーされていない、もしくは名前が違います";
      msg.className = "error";
    }
  }
</script>

</body>
</html>
